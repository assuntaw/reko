<!-- DO NOT CHANGE THE ID NAMING -->
<!-- <div class="background-container dark-violet"> -->

<!-- TRIGGER JavaScript -->
<meta class="jsTrigger-search">
<!-- ENCODE "auth-token", "rekoTickImgUrl" and "userSignedId" inside hidden fields -->
<input id="rekoTickImgUrl" type="hidden" value="<%= asset_path 'white-check.svg' %>">
<input id="userSignedIn" type="hidden" value="<%= user_signed_in? %>">
<input id="params_senderName" type="hidden" value="<%= @sender_name %>">
<input id="params_token" type="hidden" value="<%= @token %>">
<!-- END OF HIDDEN FIELDS -->

<div class="background-container b-white">
  <div class="master-container">
    <div class="search-page-wrapper">
      <div class="search-top-text">
        <% if user_signed_in? %>
          Hey <%= current_user.first_name %>, <br> add Rekos to your own list!
        <% else %>
          Recommendations from <%= @sender_name %> for <%= @user.first_name %>:
        <% end %>

        <form id="formInitialSearch" class="visible">
          <div class="search-icon-wrapper">
            <input autocomplete="off" id="inputKeyword" name="" type="text" class= "search-bar-big f-gray" placeholder="Search for Rekos...">
            <img src="<%= asset_path 'search.svg'%>" alt="search">
          </div>
          <button id="buttonContinue" class= "submit-button "></button>
        </form>
        <p id="buttonBack">back</a>
      </div>
    </div>
  </div>
</div>


<script>

  // -----------------------
  // LOAD DATA + DOM OBJECTS
  // -----------------------

  // get params (from url)
  const senderName = document.getElementById('params_senderName').value;;
  const token = document.getElementById('params_token').value;
  // get DOM elements
  const formInitialSearch = document.getElementById("formInitialSearch");
  const inputKeyword = document.getElementById("inputKeyword");
  const buttonContinue = document.getElementById("buttonContinue");
  const buttonBack = document.getElementById("buttonBack");

  // ----------------------------
  // LISTENERS + HELPER FUNCTIONS
  // ----------------------------
  formInitialSearch.addEventListener("submit", (event) => {
    event.preventDefault();
    window.location = `/rekos/new?token=${token}&sender_name=${senderName}&search_term=${inputKeyword.value}`;
  });
  buttonBack.addEventListener("click", (event) => {
    window.location = `/rekos/new/onboarding?token=${token}&sender_name=${senderName}`;
  });
  inputKeyword.addEventListener("keyup", (event) => {
    setButtonState(inputKeyword.value);
  });
  const setButtonState = (userInput) => {
    if (userInput.length >= 2) {
      buttonContinue.classList.add("visible");
      buttonContinue.classList.remove("invisible");
    } else {
      buttonContinue.classList.remove("visible");
      buttonContinue.classList.add("invisible");
    }
  };

  setButtonState("");

</script>
